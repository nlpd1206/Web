<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>Rainbow Shop - Quản lý</title>
  <link rel="stylesheet" href="style.css">
  <style>
    .user-actions {
      display: flex;
      align-items: center;
      gap: 25px;
    }
    
    .user-action {
      color: white;
      text-decoration: none;
      font-size: 14px;
      transition: opacity 0.3s;
    }
    
    .user-action:hover {
      opacity: 0.8;
    }
    
    /* Layout chính */
    .main-container {
      display: flex;
      margin: 20px;
      gap: 20px;
    }
    
    /* Danh mục */
    .category-sidebar {
      width: 250px;
      padding: 20px;
      background-color: white;
      border-radius: 10px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }
    
    .category-sidebar h3 {
      margin-bottom: 15px;
      color: #6a5acd;
      padding-bottom: 10px;
      border-bottom: 1px solid #eee;
    }
    
    .category-sidebar ul {
      list-style: none;
    }
    
    .category-sidebar li {
      margin-bottom: 10px;
    }
    
    .category-sidebar a {
      color: #333;
      text-decoration: none;
      padding: 8px 12px;
      display: block;
      border-radius: 5px;
      transition: all 0.3s;
    }
    
    .category-sidebar a:hover,
    .category-sidebar a.active {
      background-color: #6a5acd;
      color: white;
    }
    
    /* Phần quản lý sản phẩm */
    .admin-content {
      flex: 1;
      background: white;
      border-radius: 10px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      padding: 25px;
    }
    
    /* Form thêm sản phẩm */
    .product-form {
      margin-bottom: 30px;
      padding: 20px;
      background: #f9f9f9;
      border-radius: 8px;
      border: 1px solid #eee;
    }
    
    .form-row {
      display: flex;
      gap: 20px;
      margin-bottom: 15px;
    }
    
    .form-row .form-group {
      flex: 1;
    }
    
    .form-group {
      margin-bottom: 15px;
    }
    
    .form-group label {
      display: block;
      margin-bottom: 5px;
      font-weight: 600;
      color: #555;
    }
    
    .form-group input,
    .form-group textarea,
    .form-group select {
      width: 100%;
      padding: 10px 12px;
      border: 1px solid #ddd;
      border-radius: 4px;
      font-size: 14px;
      transition: border 0.3s;
    }
    
    .form-group input:focus,
    .form-group textarea:focus,
    .form-group select:focus {
      border-color: #6a5acd;
      outline: none;
    }
    
    .form-group textarea {
      min-height: 100px;
      resize: vertical;
    }
    
    .form-actions {
      display: flex;
      gap: 10px;
      margin-top: 20px;
    }
    
    .btn {
      padding: 10px 18px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 14px;
      font-weight: 500;
      transition: all 0.3s;
    }
    
    .btn-primary {
      background-color: #6a5acd;
      color: white;
    }
    
    .btn-primary:hover {
      background-color: #5a4abd;
    }
    
    .btn-secondary {
      background-color: #f0f0f0;
      color: #333;
    }
    
    .btn-secondary:hover {
      background-color: #e0e0e0;
    }
    
    .btn-reset {
      background-color: transparent;
      color: #6a5acd;
      border: 1px solid #6a5acd;
    }
    
    .btn-reset:hover {
      background-color: #f0eefc;
    }
    
    /* Danh sách sản phẩm */
    .product-list-admin {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
      gap: 20px;
      margin-top: 30px;
      align-items: stretch;
    }
    
    .product-card-admin {
      background: white;
      border-radius: 8px;
      padding: 15px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
      border: 1px solid #eee;
      display: flex;
      flex-direction: column;
      transition: transform 0.3s, box-shadow 0.3s;
    }
    
    .product-card-admin:hover {
      transform: translateY(-5px);
      box-shadow: 0 5px 15px rgba(0,0,0,0.1);
    }
    
    .product-card-admin img {
      width: 100%;
      height: 180px;
      object-fit: contain;
      border-radius: 4px;
      margin-bottom: 15px;
      background: #f5f5f5;
    }
    
    .product-info {
      flex-grow: 1;
      margin-bottom: 15px;
    }
    
    .product-card-admin h4 {
      margin: 0 0 8px;
      font-size: 16px;
      color: #333;
    }
    
    .product-card-admin .price {
      color: #d0011b;
      font-weight: bold;
      margin-bottom: 8px;
      font-size: 15px;
    }
    
    .product-card-admin .category {
      color: #666;
      font-size: 13px;
      margin-bottom: 8px;
    }
    
    .product-card-admin .stock {
      color: #666;
      font-size: 13px;
    }
    
    .product-actions {
      display: flex;
      gap: 10px;
      margin-top: auto;
    }
    
    .btn-edit {
      background-color: #ffc107;
      color: #333;
    }
    
    .btn-edit:hover {
      background-color: #e0a800;
    }
    
    .btn-delete {
      background-color: #dc3545;
      color: white;
    }
    
    .btn-delete:hover {
      background-color: #c82333;
    }
    
    /* Bộ lọc và tìm kiếm */
    .filter-section {
      display: flex;
      justify-content: space-between;
      margin-bottom: 20px;
      gap: 15px;
    }
    
    .search-box {
      display: flex;
      flex: 1;
      max-width: 400px;
    }
    
    .search-box input {
      flex: 1;
      padding: 10px 15px;
      border: 1px solid #ddd;
      border-radius: 4px 0 0 4px;
      font-size: 14px;
    }
    
    .search-box button {
      padding: 0 15px;
      background-color: #6a5acd;
      color: white;
      border: none;
      border-radius: 0 4px 4px 0;
      cursor: pointer;
    }
    
    #sortProducts {
      padding: 10px;
      border: 1px solid #ddd;
      border-radius: 4px;
      font-size: 14px;
    }
    
    /* Phân trang */
    .pagination {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 15px;
      margin-top: 30px;
    }
    
    .pagination button {
      padding: 8px 15px;
      background-color: #6a5acd;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
    }
    
    .pagination button:disabled {
      background-color: #ccc;
      cursor: not-allowed;
    }
    
    /* Modal */
    .modal {
      display: none;
      position: fixed;
      z-index: 1000;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0,0,0,0.5);
    }
    
    .modal-content {
      background-color: #fff;
      margin: 15% auto;
      padding: 25px;
      border-radius: 8px;
      width: 400px;
      max-width: 90%;
      box-shadow: 0 5px 15px rgba(0,0,0,0.3);
    }
    
    .modal-actions {
      display: flex;
      justify-content: flex-end;
      gap: 10px;
      margin-top: 25px;
    }
    
    .close-modal {
      float: right;
      font-size: 24px;
      cursor: pointer;
      color: #aaa;
    }
    
    .close-modal:hover {
      color: #333;
    }
    
    /* Thông báo */
    .notification {
      display: none;
      padding: 15px;
      margin-bottom: 20px;
      border-radius: 4px;
      font-weight: 500;
    }
    
    .notification.success {
      background-color: #d4edda;
      color: #155724;
      border: 1px solid #c3e6cb;
    }
    
    .notification.error {
      background-color: #f8d7da;
      color: #721c24;
      border: 1px solid #f5c6cb;
    }
    
    /* Responsive */
    @media (max-width: 992px) {
      .main-container {
        flex-direction: column;
      }
      
      .category-sidebar {
        width: 100%;
        margin-bottom: 20px;
      }
      
      .form-row {
        flex-direction: column;
        gap: 0;
      }
    }
    
    @media (max-width: 576px) {
      .filter-section {
        flex-direction: column;
      }
      
      .search-box {
        max-width: 100%;
      }
    }
  </style>
</head>
<body>
  <!-- Header -->
  <div class="header">
    <a href="TrangChu.html" style="text-decoration: none;">
      <span class="rainbow-text">Rainbow</span>
    </a>
  </div>
  
  <!-- Main content -->
  <div class="main-container">
    
    <!-- Nội dung quản lý -->
    <div class="admin-content">
      <h1>Quản lý sản phẩm</h1>
      
      <!-- Thông báo -->
      <div id="notification" class="notification" style="display:none;"></div>
      
      <!-- Form thêm/sửa sản phẩm -->
      <form id="productForm" class="product-form">
        <input type="hidden" id="productId">
        
        <div class="form-row">
          <div class="form-group">
            <label for="productName">Tên sản phẩm <span class="required">*</span></label>
            <input type="text" id="productName" required>
          </div>
          
          <div class="form-group">
            <label for="productPrice">Giá (VNĐ) <span class="required">*</span></label>
            <input type="number" id="productPrice" required min="1000">
          </div>
        </div>
        
        <div class="form-row">
          <div class="form-group">
            <label for="productCategory">Danh mục <span class="required">*</span></label>
            <select id="productCategory" required>
              <option value="">-- Chọn danh mục --</option>
              <option value="dienthoai">Điện thoại</option>
              <option value="quanao">Quần áo</option>
              <option value="giaydep">Giày dép</option>
              <option value="phukien">Phụ kiện</option>
              <option value="khac">Khác</option>
            </select>
          </div>
          
          <div class="form-group">
            <label for="productStock">Số lượng tồn kho <span class="required">*</span></label>
            <input type="number" id="productStock" required min="0" value="0">
          </div>
        </div>
        
        <div class="form-group">
          <label for="productImage">Hình ảnh <span class="required">*</span></label>
          <div class="image-upload-container">
            <input type="file" id="productImage" accept="image/*" required>
            <label for="productImage" class="upload-label">
              <span id="fileName">Chọn ảnh...</span>
              <i class="upload-icon">📁</i>
            </label>
            <div id="imagePreview" class="image-preview">
              <img id="previewImage" style="display:none;">
              <span id="removeImage" style="display:none;">✖</span>
            </div>
          </div>
        </div>
        
        <div class="form-group">
          <label for="productDesc">Mô tả sản phẩm</label>
          <textarea id="productDesc" rows="4"></textarea>
        </div>
        
        <div class="form-row">
          <div class="form-group">
            <label for="productColors">Màu sắc (ngăn cách bằng dấu phẩy)</label>
            <input type="text" id="productColors" placeholder="Ví dụ: Đỏ,Xanh,Đen">
          </div>
          
          <div class="form-group">
            <label for="productSizes">Kích cỡ (ngăn cách bằng dấu phẩy)</label>
            <input type="text" id="productSizes" placeholder="Ví dụ: S,M,L,XL">
          </div>
        </div>
        
        <div class="form-actions">
          <button type="submit" class="btn btn-primary" id="submitBtn">Thêm sản phẩm</button>
          <button type="button" class="btn btn-secondary" id="cancelEdit" style="display:none;">Hủy bỏ</button>
          <button type="reset" class="btn btn-reset">Làm mới</button>
        </div>
      </form>
      
      <!-- Bộ lọc và tìm kiếm -->
      <div class="filter-section">
        <div class="search-box">
          <input type="text" id="searchProduct" placeholder="Tìm kiếm sản phẩm...">
          <button id="searchBtn">🔍</button>
        </div>
        <select id="sortProducts">
          <option value="newest">Mới nhất</option>
          <option value="oldest">Cũ nhất</option>
          <option value="price_asc">Giá tăng dần</option>
          <option value="price_desc">Giá giảm dần</option>
        </select>
      </div>
      
      <!-- Danh sách sản phẩm -->
      <div class="product-list-container">
        <h2>Danh sách sản phẩm <span id="productCount">(0 sản phẩm)</span></h2>
        
        <div class="product-list-admin" id="productList">
          <!-- Sản phẩm sẽ được thêm bằng JavaScript -->
          <div class="no-products">
            <img src="img/no-products.png" alt="No products">
            <p>Chưa có sản phẩm nào</p>
            <button class="btn btn-primary" onclick="document.getElementById('productForm').scrollIntoView()">Thêm sản phẩm mới</button>
          </div>
        </div>
        
        <!-- Phân trang -->
        <div class="pagination" id="pagination" style="display:none;">
          <button id="prevPage">← Trước</button>
          <span id="pageInfo">Trang 1/1</span>
          <button id="nextPage">Sau →</button>
        </div>
      </div>
    </div>
  </div>
  
  <!-- Footer -->
    <div class="footer">
    <div class="contact-info">Thông tin liên hệ: 1900 1000</div>
    <p>© 2025 Rainbow Shop</p>
  </div>

  <!-- Modal xác nhận xóa -->
  <div id="confirmModal" class="modal">
    <div class="modal-content">
      <span class="close-modal">&times;</span>
      <h3>Xác nhận xóa sản phẩm</h3>
      <p>Bạn có chắc chắn muốn xóa sản phẩm này?</p>
      <div class="modal-actions">
        <button id="confirmDelete" class="btn btn-danger">Xóa</button>
        <button id="cancelDelete" class="btn btn-secondary">Hủy</button>
      </div>
    </div>
  </div>

  <script>
  document.addEventListener('DOMContentLoaded', function() {
    // Kiểm tra đăng nhập
    const currentUser = JSON.parse(localStorage.getItem('currentUser'));
    if (!currentUser || currentUser.role !== 'seller') {
      alert('Bạn không có quyền truy cập trang này!');
      window.location.href = 'TrangChu.html';
      return;
    }

    // Khởi tạo
    let products = JSON.parse(localStorage.getItem('products')) || [];
    let editingProductId = null;
    let currentPage = 1;
    const productsPerPage = 10; // Hiển thị 10 sản phẩm mỗi trang
    let filteredProducts = [...products];
    let currentProductIdToDelete = null;

    // DOM Elements
    const productForm = document.getElementById('productForm');
    const productList = document.getElementById('productList');
    const notification = document.getElementById('notification');
    const productCount = document.getElementById('productCount');
    const pagination = document.getElementById('pagination');
    const pageInfo = document.getElementById('pageInfo');
    const searchInput = document.getElementById('searchProduct');
    const sortSelect = document.getElementById('sortProducts');
    const imageInput = document.getElementById('productImage');
    const previewImage = document.getElementById('previewImage');
    const fileName = document.getElementById('fileName');
    const removeImage = document.getElementById('removeImage');
    const confirmModal = document.getElementById('confirmModal');
    const confirmDeleteBtn = document.getElementById('confirmDelete');
    const cancelDeleteBtn = document.getElementById('cancelDelete');
    const closeModalBtn = document.querySelector('.close-modal');

    // Hiển thị sản phẩm ban đầu
    renderProducts();

    // Xử lý upload ảnh
    imageInput.addEventListener('change', function(e) {
      const file = e.target.files[0];
      if (file) {
        fileName.textContent = file.name;
        const reader = new FileReader();
        reader.onload = function(e) {
          previewImage.src = e.target.result;
          previewImage.style.display = 'block';
          removeImage.style.display = 'block';
        };
        reader.readAsDataURL(file);
      }
    });

    // Xóa ảnh preview
    removeImage.addEventListener('click', function() {
      imageInput.value = '';
      previewImage.src = '';
      previewImage.style.display = 'none';
      fileName.textContent = 'Chọn ảnh...';
      removeImage.style.display = 'none';
    });

    // Submit form
    productForm.addEventListener('submit', async function(e) {
      e.preventDefault();
      
      // Validate form
      const name = document.getElementById('productName').value.trim();
      const price = document.getElementById('productPrice').value;
      const category = document.getElementById('productCategory').value;
      const stock = document.getElementById('productStock').value;
      
      if (!name || !price || !category || !stock) {
        showNotification('Vui lòng điền đầy đủ thông tin bắt buộc', 'error');
        return;
      }
      
      if (!imageInput.files[0] && !editingProductId) {
        showNotification('Vui lòng chọn ảnh sản phẩm', 'error');
        return;
      }

      try {
        // Tạo object sản phẩm
        const productData = {
          id: editingProductId || Date.now(),
          name,
          price: parseInt(price),
          desc: document.getElementById('productDesc').value.trim(),
          stock: parseInt(stock),
          colors: document.getElementById('productColors').value.trim() || '',
          sizes: document.getElementById('productSizes').value.trim() || '',
          category,
          createdAt: editingProductId ? 
            products.find(p => p.id === editingProductId)?.createdAt || new Date().toISOString() : 
            new Date().toISOString(),
          updatedAt: new Date().toISOString()
        };

        // Xử lý ảnh nếu có
        if (imageInput.files[0]) {
          productData.image = await readFileAsDataURL(imageInput.files[0]);
        } else if (editingProductId) {
          // Giữ nguyên ảnh cũ khi chỉnh sửa
          const existingProduct = products.find(p => p.id === editingProductId);
          if (existingProduct) {
            productData.image = existingProduct.image;
          }
        }

        // Lưu sản phẩm
        saveProduct(productData);
      } catch (error) {
        console.error('Lỗi khi thêm sản phẩm:', error);
        showNotification('Có lỗi xảy ra khi thêm sản phẩm', 'error');
      }
    });

    // Hàm đọc file ảnh thành Data URL
    function readFileAsDataURL(file) {
      return new Promise((resolve, reject) => {
        const reader = new FileReader();
        reader.onload = () => resolve(reader.result);
        reader.onerror = reject;
        reader.readAsDataURL(file);
      });
    }

    // Cập nhật hàm saveProduct
    // Thay thế hàm saveProduct bằng đoạn code sau
function saveProduct(productData) {
  let products = JSON.parse(localStorage.getItem('products')) || [];
  
  // Đảm bảo ID là number
  productData.id = parseInt(productData.id) || Date.now();
  
  if (imageInput.files[0]) {
    // Lưu tên file thay vì Data URL
    productData.image = 'img/' + imageInput.files[0].name;
  } else if (editingProductId) {
    // Giữ nguyên ảnh cũ nếu đang chỉnh sửa
    const existingProduct = products.find(p => p.id === editingProductId);
    if (existingProduct) productData.image = existingProduct.image;
  }

  if (editingProductId) {
    const index = products.findIndex(p => p.id === editingProductId);
    if (index !== -1) {
      products[index] = productData;
    } else {
      products.unshift(productData);
    }
  } else {
    products.unshift(productData);
  }
  
  localStorage.setItem('products', JSON.stringify(products));
  showNotification(editingProductId ? 'Cập nhật thành công!' : 'Thêm thành công!', 'success');
  resetForm();
  renderProducts();
}

    // Reset form
    function resetForm() {
      productForm.reset();
      document.getElementById('productId').value = '';
      previewImage.src = '';
      previewImage.style.display = 'none';
      fileName.textContent = 'Chọn ảnh...';
      removeImage.style.display = 'none';
      editingProductId = null;
      document.getElementById('submitBtn').textContent = 'Thêm sản phẩm';
      document.getElementById('cancelEdit').style.display = 'none';
    }

    // Hiển thị sản phẩm
    function renderProducts() {
      if (filteredProducts.length === 0) {
        productList.innerHTML = `
          <div class="no-products">
            <img src="img/no-products.png" alt="No products">
            <p>Không tìm thấy sản phẩm nào</p>
            <button class="btn btn-primary" onclick="document.getElementById('productForm').scrollIntoView()">Thêm sản phẩm mới</button>
          </div>
        `;
        pagination.style.display = 'none';
        productCount.textContent = '(0 sản phẩm)';
        return;
      }

      // Phân trang
      const startIndex = (currentPage - 1) * productsPerPage;
      const endIndex = startIndex + productsPerPage;
      const paginatedProducts = filteredProducts.slice(startIndex, endIndex);

      // Render sản phẩm
      productList.innerHTML = paginatedProducts.map(product => `
        <div class="product-card-admin" data-id="${product.id}">
          <img src="${product.image}" alt="${product.name}" onerror="this.src='img/no-image.png'">
          <div class="product-info">
            <h4>${product.name}</h4>
            <p class="price">${product.price.toLocaleString()}đ</p>
            <p class="category">${getCategoryName(product.category)}</p>
            <p class="stock">Tồn kho: ${product.stock}</p>
          </div>
          <div class="product-actions">
            <button class="btn btn-edit" data-id="${product.id}">Sửa</button>
            <button class="btn btn-delete" data-id="${product.id}">Xóa</button>
          </div>
        </div>
      `).join('');

      // Gắn sự kiện cho các nút
      document.querySelectorAll('.btn-edit').forEach(btn => {
        btn.addEventListener('click', function() {
          editProduct(this.getAttribute('data-id'));
        });
      });

      document.querySelectorAll('.btn-delete').forEach(btn => {
        btn.addEventListener('click', function() {
          showDeleteModal(this.getAttribute('data-id'));
        });
      });

      // Hiển thị phân trang
      const totalPages = Math.ceil(filteredProducts.length / productsPerPage);
      if (totalPages > 1) {
        pagination.style.display = 'flex';
        pageInfo.textContent = `Trang ${currentPage}/${totalPages}`;
        document.getElementById('prevPage').disabled = currentPage === 1;
        document.getElementById('nextPage').disabled = currentPage === totalPages;
      } else {
        pagination.style.display = 'none';
      }

      productCount.textContent = `(${filteredProducts.length} sản phẩm)`;
    }

    // Hàm hiển thị modal xóa
    window.showDeleteModal = function(productId) {
      currentProductIdToDelete = productId;
      confirmModal.style.display = 'block';
    };

    // Xác nhận xóa
    confirmDeleteBtn.addEventListener('click', function() {
      if (currentProductIdToDelete) {
        deleteProduct(currentProductIdToDelete);
        confirmModal.style.display = 'none';
      }
    });

    // Hủy xóa
    cancelDeleteBtn.addEventListener('click', function() {
      confirmModal.style.display = 'none';
    });

    // Đóng modal
    closeModalBtn.addEventListener('click', function() {
      confirmModal.style.display = 'none';
    });

    // Đóng modal khi click ra ngoài
    window.addEventListener('click', function(event) {
      if (event.target === confirmModal) {
        confirmModal.style.display = 'none';
      }
    });

    // Hàm xóa sản phẩm
    // Hàm xóa sản phẩm (sửa lại)
function deleteProduct(productId) {
  // Đảm bảo productId là number
  productId = typeof productId === 'string' ? parseInt(productId) : productId;
  
  // Lấy danh sách sản phẩm từ localStorage (luôn lấy mới nhất)
  let products = JSON.parse(localStorage.getItem('products')) || [];
  
  // Tạo mảng mới không chứa sản phẩm cần xóa
  const updatedProducts = products.filter(p => p.id !== productId);
  
  // Lưu lại vào localStorage
  localStorage.setItem('products', JSON.stringify(updatedProducts));
  
  // Cập nhật lại biến toàn cục
  products = updatedProducts;
  filteredProducts = [...updatedProducts];
  
  // Reset nếu đang edit sản phẩm bị xóa
  if (editingProductId === productId) {
    resetForm();
  }
  
  showNotification('Xóa sản phẩm thành công!', 'success');
  renderProducts();
}

// Cập nhật hàm saveProduct
function saveProduct(productData) {
  // Luôn lấy danh sách mới nhất từ localStorage
  let products = JSON.parse(localStorage.getItem('products')) || [];
  
  if (editingProductId) {
    // Cập nhật sản phẩm
    const index = products.findIndex(p => p.id === editingProductId);
    if (index !== -1) {
      products[index] = productData;
    } else {
      products.unshift(productData);
    }
  } else {
    // Thêm sản phẩm mới vào đầu mảng
    products.unshift(productData);
  }
  
  // Lưu vào localStorage
  localStorage.setItem('products', JSON.stringify(products));
  
  // Cập nhật biến toàn cục
  products = JSON.parse(localStorage.getItem('products')) || [];
  filteredProducts = [...products];
  
  showNotification(editingProductId ? 'Cập nhật sản phẩm thành công!' : 'Thêm sản phẩm thành công!', 'success');
  resetForm();
  renderProducts();
}

    // Sửa sản phẩm
    window.editProduct = function(productId) {
      // Đảm bảo productId là number
      productId = parseInt(productId);
      
      // Lấy dữ liệu từ localStorage
      const products = JSON.parse(localStorage.getItem('products')) || [];
      
      // Tìm sản phẩm theo ID
      const product = products.find(p => p.id === productId);
      
      if (!product) {
        console.error('Không tìm thấy sản phẩm với ID:', productId);
        console.log('Danh sách sản phẩm hiện có:', products);
        showNotification('Không tìm thấy sản phẩm để sửa', 'error');
        return;
      }

      // Điền dữ liệu vào form
      document.getElementById('productId').value = product.id;
      document.getElementById('productName').value = product.name;
      document.getElementById('productPrice').value = product.price;
      document.getElementById('productDesc').value = product.desc || '';
      document.getElementById('productStock').value = product.stock || 0;
      document.getElementById('productColors').value = product.colors || '';
      document.getElementById('productSizes').value = product.sizes || '';
      document.getElementById('productCategory').value = product.category || '';

      // Hiển thị ảnh
      previewImage.src = product.image || '';
      previewImage.style.display = product.image ? 'block' : 'none';
      fileName.textContent = product.image ? 'Ảnh sản phẩm' : 'Chọn ảnh...';
      removeImage.style.display = product.image ? 'block' : 'none';

      editingProductId = product.id;
      document.getElementById('submitBtn').textContent = 'Cập nhật';
      document.getElementById('cancelEdit').style.display = 'inline-block';
      
      // Cuộn đến form
      productForm.scrollIntoView({ behavior: 'smooth' });
    };

    // Lọc và sắp xếp sản phẩm
    function filterAndSortProducts() {
      const searchTerm = searchInput.value.toLowerCase();
      const sortValue = sortSelect.value;
      
      // Lọc theo từ khóa
      filteredProducts = products.filter(product => 
        product.name.toLowerCase().includes(searchTerm) ||
        (product.desc && product.desc.toLowerCase().includes(searchTerm)) ||
        product.category.toLowerCase().includes(searchTerm)
      );
      
      // Sắp xếp
      switch (sortValue) {
        case 'newest':
          filteredProducts.sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));
          break;
        case 'oldest':
          filteredProducts.sort((a, b) => new Date(a.createdAt) - new Date(b.createdAt));
          break;
        case 'price_asc':
          filteredProducts.sort((a, b) => a.price - b.price);
          break;
        case 'price_desc':
          filteredProducts.sort((a, b) => b.price - a.price);
          break;
      }
      
      currentPage = 1;
      renderProducts();
    }

    // Hiển thị thông báo
    function showNotification(message, type) {
      notification.textContent = message;
      notification.className = `notification ${type}`;
      notification.style.display = 'block';
      
      setTimeout(() => {
        notification.style.display = 'none';
      }, 3000);
    }

    // Lấy tên danh mục
    function getCategoryName(category) {
      const categories = {
        dienthoai: 'Điện thoại',
        quanao: 'Quần áo',
        giaydep: 'Giày dép',
        phukien: 'Phụ kiện',
        khac: 'Khác'
      };
      return categories[category] || category;
    }

    // Phân trang
    document.getElementById('prevPage').addEventListener('click', function() {
      if (currentPage > 1) {
        currentPage--;
        renderProducts();
      }
    });

    document.getElementById('nextPage').addEventListener('click', function() {
      const totalPages = Math.ceil(filteredProducts.length / productsPerPage);
      if (currentPage < totalPages) {
        currentPage++;
        renderProducts();
      }
    });

    // Tìm kiếm và sắp xếp
    searchInput.addEventListener('input', filterAndSortProducts);
    sortSelect.addEventListener('change', filterAndSortProducts);

    // Hủy chỉnh sửa
    document.getElementById('cancelEdit').addEventListener('click', resetForm);

    // Đăng xuất
    document.getElementById('logoutBtn').addEventListener('click', function(e) {
      e.preventDefault();
      if (confirm('Bạn có chắc muốn đăng xuất không?')) {
        localStorage.removeItem('currentUser');
        window.location.href = 'TrangChu.html';
      }
    });

    // Lọc theo danh mục
    document.querySelectorAll('.category-filter').forEach(link => {
      link.addEventListener('click', function(e) {
        e.preventDefault();
        
        // Cập nhật active
        document.querySelectorAll('.category-filter').forEach(item => {
          item.classList.remove('active');
        });
        this.classList.add('active');
        
        const category = this.getAttribute('data-category');
        if (category === 'all') {
          filteredProducts = [...products];
        } else {
          filteredProducts = products.filter(p => p.category === category);
        }
        
        currentPage = 1;
        renderProducts();
      });
    });
  }); 
  </script>
</body>
</html>
